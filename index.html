<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡∏≠‡∏ô‡∏≠‡∏ô</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class'
        }
    </script>
</head>
<body>
    <div id="app"></div>

    <script>
        // App State
        const app = {
            isLoggedIn: false,
            currentUser: null,
            darkMode: localStorage.getItem('dorm_darkMode') === 'true',
            currentPage: 'attendance',
            sidebarOpen: false,
            showModals: {
                addStudent: false,
                changePassword: false,
                addUser: false
            },
            
            // Data
            users: JSON.parse(localStorage.getItem('dorm_users')) || [
                { id: 1, username: 'admin', password: 'admin123', name: '‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏ö‡∏ö', role: 'admin' },
                { id: 2, username: 'teacher', password: 'teacher123', name: '‡∏Ñ‡∏£‡∏π‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏´‡∏≠', role: 'teacher' }
            ],
            
            systemSettings: JSON.parse(localStorage.getItem('dorm_settings')) || {
                schoolName: '‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥',
                dormName: '‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡∏≠‡∏ô‡∏≠‡∏ô'
            },
            
            students: JSON.parse(localStorage.getItem('dorm_students')) || [
                { id: 1, code: '1825', name: '‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á‡∏£‡∏±‡∏Å‡∏ä‡∏µ‡∏ß‡∏≤', nickname: '‡∏Ñ‡∏£‡∏±‡∏ö‡πÅ‡∏Ñ‡∏£‡∏á', disability: '', dorm: '‡πÄ‡∏£‡∏∑‡∏≠‡∏ô‡∏ô‡∏≠‡∏ô‡∏û‡∏∏‡∏ó‡∏ò‡∏£‡∏±‡∏Å‡∏©‡∏≤', room: '‡∏´‡πâ‡∏≠‡∏á 101', group: '‡∏ï‡∏≤‡∏°‡∏ï‡∏≤‡∏£‡∏≤‡∏á' },
                { id: 2, code: '1888', name: '‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á‡∏ô‡∏¥‡∏ï‡∏£‡∏£‡∏õ‡∏£‡∏¥‡∏ß‡∏£‡∏£‡∏ï', nickname: '‡∏Ç‡πà‡∏≤‡∏à‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô', disability: '', dorm: '‡πÄ‡∏£‡∏∑‡∏≠‡∏ô‡∏ô‡∏≠‡∏ô‡∏û‡∏∏‡∏ó‡∏ò‡∏£‡∏±‡∏Å‡∏©‡∏≤', room: '‡∏´‡πâ‡∏≠‡∏á 102', group: '‡∏ï‡∏≤‡∏°‡∏ï‡∏≤‡∏£‡∏≤‡∏á' },
                { id: 3, code: '1891', name: '‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á‡∏ó‡∏∏‡∏Å‡∏•‡∏≠‡∏¢‡∏£‡∏ß‡∏±‡∏ï‡∏£', nickname: '‡∏™‡∏∏‡∏î‡πÄ‡∏•‡πà‡∏≤', disability: '', dorm: '‡πÄ‡∏£‡∏∑‡∏≠‡∏ô‡∏ô‡∏≠‡∏ô‡∏Å‡∏≤‡∏ã‡∏∞‡∏•‡∏≠‡∏á', room: '‡∏´‡πâ‡∏≠‡∏á 201', group: '‡∏ï‡∏≤‡∏°‡∏ï‡∏≤‡∏£‡∏≤‡∏á' },
                { id: 4, code: '1901', name: '‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á‡πÇ‡∏õ‡∏£‡∏ä‡∏¥‡∏ã‡∏≤', nickname: '‡∏°‡∏ß‡∏•‡πÇ‡∏ö‡∏ß‡πå', disability: '', dorm: '‡πÄ‡∏£‡∏∑‡∏≠‡∏ô‡∏ô‡∏≠‡∏ô‡∏Å‡∏≤‡∏ã‡∏∞‡∏•‡∏≠‡∏á', room: '‡∏´‡πâ‡∏≠‡∏á 202', group: '‡∏ï‡∏≤‡∏°‡∏ï‡∏≤‡∏£‡∏≤‡∏á' },
                { id: 5, code: '1835', name: '‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á‡∏ô‡∏≠‡∏°‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏ô‡πå', nickname: '‡∏™‡∏°‡∏ä‡∏≤‡∏ç‡πÉ‡∏´‡∏ç‡πà', disability: '', dorm: '‡πÄ‡∏£‡∏∑‡∏≠‡∏ô‡∏ô‡∏≠‡∏ô‡∏ó‡∏≠‡∏á‡∏õ‡∏≤‡∏£‡∏¥‡∏ä‡∏≤‡∏ï', room: '‡∏´‡πâ‡∏≠‡∏á 301', group: '‡∏ï‡∏≤‡∏°‡∏ï‡∏≤‡∏£‡∏≤‡∏á' }
            ],
            
            attendance: JSON.parse(localStorage.getItem('dorm_attendance')) || {},
            medications: JSON.parse(localStorage.getItem('dorm_medications')) || {},
            healthData: JSON.parse(localStorage.getItem('dorm_health')) || {},
            
            selectedDate: new Date().toISOString().split('T')[0],
            selectedDorm: '‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î',
            searchTerm: '',
            loginError: '',
            toastMessage: '',
            toastType: 'success',
            
            dormitories: ['‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î', '‡πÄ‡∏£‡∏∑‡∏≠‡∏ô‡∏ô‡∏≠‡∏ô‡∏û‡∏∏‡∏ó‡∏ò‡∏£‡∏±‡∏Å‡∏©‡∏≤', '‡πÄ‡∏£‡∏∑‡∏≠‡∏ô‡∏ô‡∏≠‡∏ô‡∏Å‡∏≤‡∏ã‡∏∞‡∏•‡∏≠‡∏á', '‡πÄ‡∏£‡∏∑‡∏≠‡∏ô‡∏ô‡∏≠‡∏ô‡∏ó‡∏≠‡∏á‡∏õ‡∏≤‡∏£‡∏¥‡∏ä‡∏≤‡∏ï', '‡πÄ‡∏£‡∏∑‡∏≠‡∏ô‡∏ô‡∏≠‡∏ô‡∏£‡∏≤‡∏ä‡∏û‡∏§‡∏Å‡∏©‡πå', '‡πÄ‡∏£‡∏∑‡∏≠‡∏ô‡∏ô‡∏≠‡∏ô‡∏®‡∏£‡∏µ‡∏ï‡∏£‡∏±‡∏á', '‡πÄ‡∏£‡∏∑‡∏≠‡∏ô‡∏ô‡∏≠‡∏ô‡∏•‡∏µ‡∏•‡∏≤‡∏ß‡∏î‡∏µ'],
            medicationTimes: ['‡πÄ‡∏ä‡πâ‡∏≤ ‡∏Å‡πà‡∏≠‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£', '‡πÄ‡∏ä‡πâ‡∏≤ ‡∏´‡∏•‡∏±‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£', '‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô', '‡πÄ‡∏¢‡πá‡∏ô ‡∏Å‡πà‡∏≠‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£', '‡πÄ‡∏¢‡πá‡∏ô ‡∏´‡∏•‡∏±‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£', '‡∏Å‡∏•‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô'],
            
            // Form data
            newStudent: { code: '', name: '', nickname: '', disability: '', dorm: '‡πÄ‡∏£‡∏∑‡∏≠‡∏ô‡∏ô‡∏≠‡∏ô‡∏û‡∏∏‡∏ó‡∏ò‡∏£‡∏±‡∏Å‡∏©‡∏≤', room: '', group: '‡∏ï‡∏≤‡∏°‡∏ï‡∏≤‡∏£‡∏≤‡∏á' },
            passwordForm: { old: '', new: '', confirm: '' },
            newUserForm: { username: '', password: '', name: '', role: 'teacher' },
            loginForm: { username: '', password: '' }
        };

        // Helper Functions
        const saveData = () => {
            localStorage.setItem('dorm_users', JSON.stringify(app.users));
            localStorage.setItem('dorm_settings', JSON.stringify(app.systemSettings));
            localStorage.setItem('dorm_students', JSON.stringify(app.students));
            localStorage.setItem('dorm_attendance', JSON.stringify(app.attendance));
            localStorage.setItem('dorm_medications', JSON.stringify(app.medications));
            localStorage.setItem('dorm_health', JSON.stringify(app.healthData));
        };

        const showToast = (message, type = 'success') => {
            app.toastMessage = message;
            app.toastType = type;
            render();
            setTimeout(() => {
                app.toastMessage = '';
                render();
            }, 3000);
        };

        const handleLogin = () => {
            if (!app.loginForm.username || !app.loginForm.password) {
                app.loginError = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡∏∞‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô';
                render();
                return;
            }
            const user = app.users.find(u => u.username === app.loginForm.username && u.password === app.loginForm.password);
            if (user) {
                app.isLoggedIn = true;
                app.currentUser = user;
                app.loginError = '';
                app.loginForm = { username: '', password: '' };
                showToast('‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                render();
            } else {
                app.loginError = '‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á';
                render();
            }
        };

        const handleLogout = () => {
            app.isLoggedIn = false;
            app.currentUser = null;
            app.currentPage = 'attendance';
            showToast('‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
        };

        const handleAddStudent = () => {
            if (!app.newStudent.code || !app.newStudent.name || !app.newStudent.room) {
                showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å ‡∏£‡∏´‡∏±‡∏™, ‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏• ‡πÅ‡∏•‡∏∞‡∏´‡πâ‡∏≠‡∏á', 'error');
                return;
            }
            if (!/^\d{4}$/.test(app.newStudent.code)) {
                showToast('‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç 4 ‡∏´‡∏•‡∏±‡∏Å', 'error');
                return;
            }
            if (app.students.find(s => s.code === app.newStudent.code)) {
                showToast('‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß', 'error');
                return;
            }
            const newId = Math.max(...app.students.map(s => s.id), 0) + 1;
            app.students.push({ id: newId, ...app.newStudent });
            app.newStudent = { code: '', name: '', nickname: '', disability: '', dorm: '‡πÄ‡∏£‡∏∑‡∏≠‡∏ô‡∏ô‡∏≠‡∏ô‡∏û‡∏∏‡∏ó‡∏ò‡∏£‡∏±‡∏Å‡∏©‡∏≤', room: '', group: '‡∏ï‡∏≤‡∏°‡∏ï‡∏≤‡∏£‡∏≤‡∏á' };
            app.showModals.addStudent = false;
            saveData();
            showToast('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
        };

        const handleDeleteStudent = (id) => {
            if (confirm('‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Ñ‡∏ô‡∏ô‡∏µ‡πâ?')) {
                app.students = app.students.filter(s => s.id !== id);
                delete app.attendance[id];
                saveData();
                showToast('‡∏•‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
            }
        };

        const handleChangePassword = () => {
            if (!app.passwordForm.old || !app.passwordForm.new || !app.passwordForm.confirm) {
                showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î', 'error');
                return;
            }
            if (app.currentUser.password !== app.passwordForm.old) {
                showToast('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏Å‡πà‡∏≤‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'error');
                return;
            }
            if (app.passwordForm.new !== app.passwordForm.confirm) {
                showToast('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô', 'error');
                return;
            }
            const userIndex = app.users.findIndex(u => u.id === app.currentUser.id);
            app.users[userIndex].password = app.passwordForm.new;
            app.currentUser.password = app.passwordForm.new;
            app.passwordForm = { old: '', new: '', confirm: '' };
            app.showModals.changePassword = false;
            saveData();
            showToast('‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
        };

        const handleAddUser = () => {
            if (!app.newUserForm.username || !app.newUserForm.password || !app.newUserForm.name) {
                showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î', 'error');
                return;
            }
            if (app.users.find(u => u.username === app.newUserForm.username)) {
                showToast('‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß', 'error');
                return;
            }
            const newId = Math.max(...app.users.map(u => u.id), 0) + 1;
            app.users.push({ id: newId, ...app.newUserForm });
            app.newUserForm = { username: '', password: '', name: '', role: 'teacher' };
            app.showModals.addUser = false;
            saveData();
            showToast('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
        };

        const updateAttendance = (studentId, session, field, value) => {
            if (!app.attendance[studentId]) app.attendance[studentId] = {};
            if (!app.attendance[studentId][session]) app.attendance[studentId][session] = {};
            app.attendance[studentId][session][field] = value;
            app.attendance[studentId][session].date = app.selectedDate;
            app.attendance[studentId][session].timestamp = new Date().toISOString();
            saveData();
        };

        const updateMedication = (studentId, med, taken) => {
            if (!app.medications[studentId]) app.medications[studentId] = {};
            app.medications[studentId][med] = { taken, date: app.selectedDate, time: new Date().toLocaleTimeString('th-TH') };
            saveData();
        };

        const updateHealth = (studentId, field, value) => {
            if (!app.healthData[studentId]) app.healthData[studentId] = {};
            app.healthData[studentId][field] = value;
            app.healthData[studentId].date = app.selectedDate;
            app.healthData[studentId].timestamp = new Date().toISOString();
            saveData();
        };

        const exportToCSV = () => {
            const filtered = getFilteredStudents();
            let csv = '‡∏£‡∏´‡∏±‡∏™,‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•,‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà,‡πÄ‡∏ä‡πâ‡∏≤-‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞,‡πÄ‡∏ä‡πâ‡∏≤-‡∏£‡∏±‡∏ö,‡πÄ‡∏ä‡πâ‡∏≤-‡∏™‡πà‡∏á,‡πÄ‡∏¢‡πá‡∏ô-‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞,‡πÄ‡∏¢‡πá‡∏ô-‡∏£‡∏±‡∏ö,‡πÄ‡∏¢‡πá‡∏ô-‡∏™‡πà‡∏á\n';
            filtered.forEach(s => {
                const morning = app.attendance[s.id]?.morning || {};
                const evening = app.attendance[s.id]?.evening || {};
                csv += `${s.code},${s.name},${app.selectedDate},${morning.status || '-'},${morning.received ? '‡πÉ‡∏ä‡πà' : '-'},${morning.sent ? '‡πÉ‡∏ä‡πà' : '-'},${evening.status || '-'},${evening.received ? '‡πÉ‡∏ä‡πà' : '-'},${evening.sent ? '‡πÉ‡∏ä‡πà' : '-'}\n`;
            });
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.href = url;
            link.download = `attendance_${app.selectedDate}.csv`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            showToast('‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
        };

        const getFilteredStudents = () => {
            return app.students.filter(student => {
                const matchesDorm = app.selectedDorm === '‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î' || student.dorm === app.selectedDorm;
                const matchesSearch = student.name.toLowerCase().includes(app.searchTerm.toLowerCase()) ||
                                     student.nickname.toLowerCase().includes(app.searchTerm.toLowerCase()) ||
                                     student.code.includes(app.searchTerm);
                return matchesDorm && matchesSearch;
            });
        };

        const getMonthlyStats = () => {
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();
            let presentCount = 0, sentCount = 0, absentCount = 0;
            Object.keys(app.attendance).forEach(studentId => {
                Object.keys(app.attendance[studentId] || {}).forEach(session => {
                    const record = app.attendance[studentId][session];
                    const recordDate = new Date(record.date);
                    if (recordDate.getMonth() === currentMonth && recordDate.getFullYear() === currentYear) {
                        if (record.status === 'present') presentCount++;
                        else if (record.status === 'sent') sentCount++;
                        else if (record.status === 'absent') absentCount++;
                    }
                });
            });
            return { presentCount, sentCount, absentCount };
        };

        const formatThaiDate = (dateStr) => {
            const date = new Date(dateStr + 'T00:00:00');
            return new Intl.DateTimeFormat('th-TH', { year: 'numeric', month: 'long', day: 'numeric' }).format(date);
        };

        // Render Function
        const render = () => {
            const isDark = app.darkMode;
            const root = document.getElementById('app');
            
            if (!app.isLoggedIn) {
                root.innerHTML = `
                    <div class="${isDark ? 'bg-gray-900' : 'bg-gradient-to-br from-blue-600 to-blue-800'} min-h-screen flex items-center justify-center p-4">
                        <div class="${isDark ? 'bg-gray-800' : 'bg-white'} rounded-2xl shadow-2xl p-8 w-full max-w-md">
                            <div class="text-center mb-8">
                                <div class="w-16 h-16 bg-blue-600 rounded-full flex items-center justify-center text-white text-3xl font-bold mx-auto mb-4">üè†</div>
                                <h1 class="${isDark ? 'text-white' : 'text-gray-800'} text-3xl font-bold">‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏≠‡∏ô‡∏≠‡∏ô</h1>
                                <p class="${isDark ? 'text-gray-400' : 'text-gray-600'} mt-2">${app.systemSettings.schoolName}</p>
                            </div>
                            <div class="space-y-4">
                                <div>
                                    <label class="${isDark ? 'text-gray-300' : 'text-gray-700'} block text-sm font-medium mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</label>
                                    <input type="text" placeholder="admin ‡∏´‡∏£‡∏∑‡∏≠ teacher" value="${app.loginForm.username}" onchange="app.loginForm.username = this.value; render();" onkeypress="if(event.key==='Enter') handleLogin(); render();" class="${isDark ? 'bg-gray-700 text-white border-gray-600' : 'border-gray-300'} w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500" />
                                </div>
                                <div>
                                    <label class="${isDark ? 'text-gray-300' : 'text-gray-700'} block text-sm font-medium mb-2">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
                                    <input type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" value="${app.loginForm.password}" onchange="app.loginForm.password = this.value; render();" onkeypress="if(event.key==='Enter') handleLogin(); render();" class="${isDark ? 'bg-gray-700 text-white border-gray-600' : 'border-gray-300'} w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500" />
                                </div>
                                ${app.loginError ? `<div class="p-3 bg-red-100 ${isDark ? 'bg-red-900 text-red-300' : 'text-red-700'} border border-red-400 rounded-lg text-sm">${app.loginError}</div>` : ''}
                                <button onclick="handleLogin(); render();" class="w-full px-4 py-3 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-lg hover:from-blue-700 hover:to-blue-800 font-bold transition-all">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
                            </div>
                            <div class="${isDark ? 'bg-gray-700 text-gray-300' : 'bg-blue-50 text-gray-700'} mt-6 p-4 rounded-lg text-sm">
                                <p class="font-bold mb-2">‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ó‡∏î‡∏™‡∏≠‡∏ö:</p>
                                <p>üë§ Admin: admin / admin123</p>
                                <p>üë®‚Äçüè´ Teacher: teacher / teacher123</p>
                            </div>
                        </div>
                    </div>
                `;
                return;
            }

            // Main App HTML
            const pages = {
                attendance: renderAttendancePage(),
                medication: renderMedicationPage(),
                health: renderHealthCheckPage(),
                statistics: renderStatisticsPage(),
                settings: renderSettingsPage()
            };

            root.innerHTML = `
                <div class="flex h-screen ${isDark ? 'bg-gray-900' : 'bg-gray-100'}">
                    <!-- Sidebar -->
                    <div class="${app.sidebarOpen ? 'translate-x-0' : '-translate-x-full'} lg:translate-x-0 fixed inset-y-0 left-0 z-50 w-64 bg-gradient-to-b from-blue-600 to-blue-800 text-white transform transition-transform duration-300">
                        <div class="p-6 border-b border-blue-700">
                            <h2 class="text-xl font-bold">${app.systemSettings.dormName}</h2>
                            <p class="text-xs text-blue-200">${app.systemSettings.schoolName}</p>
                            <button onclick="app.sidebarOpen = false; render();" class="lg:hidden absolute top-6 right-6 hover:bg-blue-700 rounded p-1">‚úï</button>
                        </div>
                        <nav class="mt-6 px-3 space-y-2">
                            ${['attendance', 'medication', 'health', 'statistics', 'settings'].map(page => {
                                const labels = { attendance: '‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠', medication: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏¢‡∏≤', health: '‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û', statistics: '‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÄ‡∏î‡∏∑‡∏≠‡∏ô', settings: '‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤' };
                                const icons = { attendance: '‚úì', medication: 'üíä', health: 'üå°Ô∏è', statistics: 'üìä', settings: '‚öôÔ∏è' };
                                return `
                                    <button onclick="app.currentPage = '${page}'; app.sidebarOpen = false; render();" class="w-full text-left px-4 py-3 rounded-lg transition-colors ${app.currentPage === page ? 'bg-blue-700 text-white' : 'text-blue-100 hover:bg-blue-700/50'}">
                                        <span class="mr-2">${icons[page]}</span>${labels[page]}
                                    </button>
                                `;
                            }).join('')}
                        </nav>
                        <div class="absolute bottom-0 left-0 right-0 p-4 border-t border-blue-700 space-y-2">
                            <button onclick="app.darkMode = !app.darkMode; localStorage.setItem('dorm_darkMode', app.darkMode); render();" class="w-full flex items-center space-x-3 px-4 py-3 text-blue-100 hover:bg-blue-700/50 rounded-lg">
                                <span>${app.darkMode ? '‚òÄÔ∏è' : 'üåô'}</span> <span>${app.darkMode ? 'Light' : 'Dark'}</span>
                            </button>
                            <button onclick="handleLogout(); render();" class="w-full flex items-center space-x-3 px-4 py-3 text-blue-100 hover:bg-blue-700/50 rounded-lg">
                                <span>üö™</span> <span>‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</span>
                            </button>
                        </div>
                    </div>

                    <!-- Main Content -->
                    <div class="flex-1 lg:ml-64 flex flex-col">
                        <div class="${isDark ? 'bg-gray-800' : 'bg-white'} shadow-sm">
                            <div class="flex items-center justify-between px-6 py-4">
                                <button onclick="app.sidebarOpen = true; render();" class="lg:hidden text-gray-600 dark:text-gray-400">‚ò∞</button>
                                <h1 class="${isDark ? 'text-white' : 'text-gray-800'} text-2xl font-bold">${app.systemSettings.dormName}</h1>
                                <div class="text-right">
                                    <p class="${isDark ? 'text-white' : 'text-gray-900'} text-sm font-medium">${app.currentUser?.name}</p>
                                    <p class="${isDark ? 'text-gray-400' : 'text-gray-500'} text-xs">${app.currentUser?.role === 'admin' ? 'üë®‚Äçüíº Admin' : 'üë®‚Äçüè´ Teacher'}</p>
                                </div>
                            </div>
                        </div>

                        <div class="${isDark ? 'bg-gray-900' : 'bg-gray-100'} flex-1 overflow-auto p-6">
                            ${pages[app.currentPage]}
                        </div>
                    </div>

                    <!-- Modals -->
                    ${renderAddStudentModal()}
                    ${renderChangePasswordModal()}
                    ${renderAddUserModal()}

                    <!-- Toast -->
                    ${app.toastMessage ? `
                        <div class="${app.toastType === 'success' ? 'bg-green-500' : 'bg-red-500'} text-white px-4 py-3 rounded-lg shadow-lg fixed top-4 right-4 z-50 flex items-center gap-2">
                            ${app.toastType === 'success' ? '‚úì' : '‚úï'} ${app.toastMessage}
                        </div>
                    ` : ''}

                    <!-- Sidebar Overlay -->
                    ${app.sidebarOpen ? `<div onclick="app.sidebarOpen = false; render();" class="fixed inset-0 bg-black bg-opacity-50 z-40 lg:hidden"></div>` : ''}
                </div>
            `;
        };

        const renderAddStudentModal = () => {
            if (!app.showModals.addStudent) return '';
            const isDark = app.darkMode;
            return `
                <div class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
                    <div class="${isDark ? 'bg-gray-800' : 'bg-white'} rounded-xl shadow-lg max-w-md w-full">
                        <div class="bg-gradient-to-r from-blue-600 to-blue-700 text-white px-6 py-4 flex items-center justify-between">
                            <h2 class="text-xl font-bold">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏´‡∏°‡πà</h2>
                            <button onclick="app.showModals.addStudent = false; render();" class="hover:bg-blue-600 rounded p-1">‚úï</button>
                        </div>
                        <div class="p-6 space-y-3">
                            <input type="text" placeholder="‡∏£‡∏´‡∏±‡∏™ (4 ‡∏´‡∏•‡∏±‡∏Å)" value="${app.newStudent.code}" onchange="app.newStudent.code = this.value; render();" class="${isDark ? 'bg-gray-700 text-white border-gray-600' : 'border-gray-300'} w-full px-3 py-2 border rounded-lg" />
                            <input type="text" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•" value="${app.newStudent.name}" onchange="app.newStudent.name = this.value; render();" class="${isDark ? 'bg-gray-700 text-white border-gray-600' : 'border-gray-300'} w-full px-3 py-2 border rounded-lg" />
                            <input type="text" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô" value="${app.newStudent.nickname}" onchange="app.newStudent.nickname = this.value; render();" class="${isDark ? 'bg-gray-700 text-white border-gray-600' : 'border-gray-300'} w-full px-3 py-2 border rounded-lg" />
                            <input type="text" placeholder="‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏¥‡∏Å‡∏≤‡∏£" value="${app.newStudent.disability}" onchange="app.newStudent.disability = this.value; render();" class="${isDark ? 'bg-gray-700 text-white border-gray-600' : 'border-gray-300'} w-full px-3 py-2 border rounded-lg" />
                            <select onchange="app.newStudent.dorm = this.value; render();" class="${isDark ? 'bg-gray-700 text-white border-gray-600' : 'border-gray-300'} w-full px-3 py-2 border rounded-lg">
                                ${app.dormitories.filter(d => d !== '‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î').map(d => `<option ${app.newStudent.dorm === d ? 'selected' : ''}>${d}</option>`).join('')}
                            </select>
                            <input type="text" placeholder="‡∏´‡πâ‡∏≠‡∏á" value="${app.newStudent.room}" onchange="app.newStudent.room = this.value; render();" class="${isDark ? 'bg-gray-700 text-white border-gray-600' : 'border-gray-300'} w-full px-3 py-2 border rounded-lg" />
                            <div class="flex gap-3 pt-4">
                                <button onclick="handleAddStudent(); render();" class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                                <button onclick="app.showModals.addStudent = false; render();" class="flex-1 px-4 py-2 bg-gray-300 ${isDark ? 'bg-gray-600' : ''} text-gray-700 ${isDark ? 'text-white' : ''} rounded-lg hover:bg-gray-400 font-medium">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        };

        const renderChangePasswordModal = () => {
            if (!app.showModals.changePassword) return '';
            const isDark = app.darkMode;
            return `
                <div class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
                    <div class="${isDark ? 'bg-gray-800' : 'bg-white'} rounded-xl shadow-lg max-w-md w-full">
                        <div class="bg-gradient-to-r from-orange-600 to-orange-700 text-white px-6 py-4 flex items-center justify-between">
                            <h2 class="text-xl font-bold">‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</h2>
                            <button onclick="app.showModals.changePassword = false; render();" class="hover:bg-orange-600 rounded p-1">‚úï</button>
                        </div>
                        <div class="p-6 space-y-3">
                            <input type="password" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏Å‡πà‡∏≤" value="${app.passwordForm.old}" onchange="app.passwordForm.old = this.value; render();" class="${isDark ? 'bg-gray-700 text-white border-gray-600' : 'border-gray-300'} w-full px-3 py-2 border rounded-lg" />
                            <input type="password" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà" value="${app.passwordForm.new}" onchange="app.passwordForm.new = this.value; render();" class="${isDark ? 'bg-gray-700 text-white border-gray-600' : 'border-gray-300'} w-full px-3 py-2 border rounded-lg" />
                            <input type="password" placeholder="‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà" value="${app.passwordForm.confirm}" onchange="app.passwordForm.confirm = this.value; render();" class="${isDark ? 'bg-gray-700 text-white border-gray-600' : 'border-gray-300'} w-full px-3 py-2 border rounded-lg" />
                            <div class="flex gap-3 pt-4">
                                <button onclick="handleChangePassword(); render();" class="flex-1 px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 font-medium">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                                <button onclick="app.showModals.changePassword = false; render();" class="flex-1 px-4 py-2 bg-gray-300 ${isDark ? 'bg-gray-600' : ''} text-gray-700 ${isDark ? 'text-white' : ''} rounded-lg hover:bg-gray-400 font-medium">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        };

        const renderAddUserModal = () => {
            if (!app.showModals.addUser) return '';
            const isDark = app.darkMode;
            return `
                <div class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
                    <div class="${isDark ? 'bg-gray-800' : 'bg-white'} rounded-xl shadow-lg max-w-md w-full">
                        <div class="bg-gradient-to-r from-green-600 to-green-700 text-white px-6 py-4 flex items-center justify-between">
                            <h2 class="text-xl font-bold">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏´‡∏°‡πà</h2>
                            <button onclick="app.showModals.addUser = false; render();" class="hover:bg-green-600 rounded p-1">‚úï</button>
                        </div>
                        <div class="p-6 space-y-3">
                            <input type="text" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ" value="${app.newUserForm.username}" onchange="app.newUserForm.username = this.value; render();" class="${isDark ? 'bg-gray-700 text-white border-gray-600' : 'border-gray-300'} w-full px-3 py-2 border rounded-lg" />
                            <input type="password" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" value="${app.newUserForm.password}" onchange="app.newUserForm.password = this.value; render();" class="${isDark ? 'bg-gray-700 text-white border-gray-600' : 'border-gray-300'} w-full px-3 py-2 border rounded-lg" />
                            <input type="text" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏ï‡πá‡∏°" value="${app.newUserForm.name}" onchange="app.newUserForm.name = this.value; render();" class="${isDark ? 'bg-gray-700 text-white border-gray-600' : 'border-gray-300'} w-full px-3 py-2 border rounded-lg" />
                            <select onchange="app.newUserForm.role = this.value; render();" class="${isDark ? 'bg-gray-700 text-white border-gray-600' : 'border-gray-300'} w-full px-3 py-2 border rounded-lg">
                                <option value="teacher">‡∏Ñ‡∏£‡∏π‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏´‡∏≠</option>
                                <option value="admin">‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏ö‡∏ö</option>
                            </select>
                            <div class="flex gap-3 pt-4">
                                <button onclick="handleAddUser(); render();" class="flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 font-medium">‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
                                <button onclick="app.showModals.addUser = false; render();" class="flex-1 px-4 py-2 bg-gray-300 ${isDark ? 'bg-gray-600' : ''} text-gray-700 ${isDark ? 'text-white' : ''} rounded-lg hover:bg-gray-400 font-medium">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        };

        const renderAttendancePage = () => {
            const isDark = app.darkMode;
            const filtered = getFilteredStudents();
            return `
                <div class="space-y-6">
                    <div class="flex justify-between items-center">
                        <h2 class="${isDark ? 'text-white' : 'text-gray-800'} text-lg font-bold">‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠</h2>
                        ${app.currentUser?.role === 'admin' ? `<button onclick="app.showModals.addStudent = true; render();" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 font-medium">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</button>` : ''}
                    </div>

                    <div class="${isDark ? 'bg-gray-800' : 'bg-white'} rounded-xl shadow-md p-6">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                            <input type="date" value="${app.selectedDate}" onchange="app.selectedDate = this.value; render();" class="${isDark ? 'bg-gray-700 text-white border-gray-600' : 'border-gray-300'} px-4 py-2 border rounded-lg" />
                            <select onchange="app.selectedDorm = this.value; render();" class="${isDark ? 'bg-gray-700 text-white border-gray-600' : 'border-gray-300'} px-4 py-2 border rounded-lg">
                                ${app.dormitories.map(d => `<option ${app.selectedDorm === d ? 'selected' : ''}>${d}</option>`).join('')}
                            </select>
                            <input type="text" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤..." value="${app.searchTerm}" onchange="app.searchTerm = this.value; render();" class="${isDark ? 'bg-gray-700 text-white border-gray-600' : 'border-gray-300'} px-4 py-2 border rounded-lg" />
                        </div>
                        <button onclick="exportToCSV();" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">üì• ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å CSV</button>
                    </div>

                    <div class="${isDark ? 'bg-gray-800' : 'bg-white'} rounded-xl shadow-md overflow-hidden">
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm">
                                <thead>
                                    <tr class="${isDark ? 'bg-gray-700' : 'bg-gradient-to-r from-blue-50 to-blue-100'} border-b-2">
                                        <th class="px-3 py-3 text-left font-semibold">‡∏£‡∏´‡∏±‡∏™</th>
                                        <th class="px-3 py-3 text-left font-semibold">‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•</th>
                                        <th colspan="3" class="px-3 py-3 text-center font-semibold bg-amber-500 text-white">‡πÄ‡∏ä‡πâ‡∏≤</th>
                                        <th colspan="3" class="px-3 py-3 text-center font-semibold bg-blue-500 text-white">‡πÄ‡∏¢‡πá‡∏ô</th>
                                        ${app.currentUser?.role === 'admin' ? '<th class="px-3 py-3 text-center">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>' : ''}
                                    </tr>
                                    <tr class="${isDark ? 'bg-gray-700' : 'bg-gray-50'} border-b">
                                        <th colspan="2"></th>
                                        <th class="px-3 py-2 text-center text-xs">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                        <th class="px-3 py-2 text-center text-xs">‚úì ‡∏£‡∏±‡∏ö</th>
                                        <th class="px-3 py-2 text-center text-xs">‚úì ‡∏™‡πà‡∏á</th>
                                        <th class="px-3 py-2 text-center text-xs">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                        <th class="px-3 py-2 text-center text-xs">‚úì ‡∏£‡∏±‡∏ö</th>
                                        <th class="px-3 py-2 text-center text-xs">‚úì ‡∏™‡πà‡∏á</th>
                                        ${app.currentUser?.role === 'admin' ? '<th></th>' : ''}
                                    </tr>
                                </thead>
                                <tbody class="${isDark ? 'divide-gray-700' : 'divide-gray-200'} divide-y">
                                    ${filtered.map(s => {
                                        const morning = app.attendance[s.id]?.morning || {};
                                        const evening = app.attendance[s.id]?.evening || {};
                                        return `
                                            <tr class="${isDark ? 'hover:bg-gray-700' : 'hover:bg-gray-50'}">
                                                <td class="px-3 py-3">${s.code}</td>
                                                <td class="px-3 py-3 font-medium">${s.name}</td>
                                                <td class="px-3 py-3">
                                                    <select onchange="updateAttendance(${s.id}, 'morning', 'status', this.value); render();" class="${isDark ? 'bg-gray-700 text-white border-gray-600' : 'border-gray-300'} w-20 px-2 py-1 text-xs border rounded">
                                                        <option value="">-</option>
                                                        <option ${morning.status === 'present' ? 'selected' : ''}>‡πÄ‡∏Ç‡πâ‡∏≤</option>
                                                        <option ${morning.status === 'sent' ? 'selected' : ''}>‡∏™‡πà‡∏á</option>
                                                        <option ${morning.status === 'absent' ? 'selected' : ''}>‡∏ñ‡∏≠‡∏ô</option>
                                                    </select>
                                                </td>
                                                <td class="px-3 py-3 text-center">
                                                    <input type="checkbox" ${morning.received ? 'checked' : ''} onchange="updateAttendance(${s.id}, 'morning', 'received', this.checked); render();" class="w-5 h-5 cursor-pointer" />
                                                </td>
                                                <td class="px-3 py-3 text-center">
                                                    <input type="checkbox" ${morning.sent ? 'checked' : ''} onchange="updateAttendance(${s.id}, 'morning', 'sent', this.checked); render();" class="w-5 h-5 cursor-pointer" />
                                                </td>
                                                <td class="px-3 py-3">
                                                    <select onchange="updateAttendance(${s.id}, 'evening', 'status', this.value); render();" class="${isDark ? 'bg-gray-700 text-white border-gray-600' : 'border-gray-300'} w-20 px-2 py-1 text-xs border rounded">
                                                        <option value="">-</option>
                                                        <option ${evening.status === 'present' ? 'selected' : ''}>‡πÄ‡∏Ç‡πâ‡∏≤</option>
                                                        <option ${evening.status === 'sent' ? 'selected' : ''}>‡∏™‡πà‡∏á</option>
                                                        <option ${evening.status === 'absent' ? 'selected' : ''}>‡∏ñ‡∏≠‡∏ô</option>
                                                    </select>
                                                </td>
                                                <td class="px-3 py-3 text-center">
                                                    <input type="checkbox" ${evening.received ? 'checked' : ''} onchange="updateAttendance(${s.id}, 'evening', 'received', this.checked); render();" class="w-5 h-5 cursor-pointer" />
                                                </td>
                                                <td class="px-3 py-3 text-center">
                                                    <input type="checkbox" ${evening.sent ? 'checked' : ''} onchange="updateAttendance(${s.id}, 'evening', 'sent', this.checked); render();" class="w-5 h-5 cursor-pointer" />
                                                </td>
                                                ${app.currentUser?.role === 'admin' ? `<td class="px-3 py-3"><button onclick="handleDeleteStudent(${s.id}); render();" class="px-3 py-1 bg-red-500 text-white text-xs rounded hover:bg-red-600">‡∏•‡∏ö</button></td>` : ''}
                                            </tr>
                                        `;
                                    }).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
        };

        const renderMedicationPage = () => {
            const isDark = app.darkMode;
            const filtered = getFilteredStudents();
            return `
                <div class="space-y-6">
                    <h2 class="${isDark ? 'text-white' : 'text-gray-800'} text-lg font-bold">üíä ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏ó‡∏≤‡∏ô‡∏¢‡∏≤</h2>
                    <div class="${isDark ? 'bg-gray-800' : 'bg-white'} rounded-xl shadow-md p-6">
                        <input type="date" value="${app.selectedDate}" onchange="app.selectedDate = this.value; render();" class="${isDark ? 'bg-gray-700 text-white border-gray-600' : 'border-gray-300'} w-full mb-4 px-4 py-2 border rounded-lg" />
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm">
                                <thead>
                                    <tr class="${isDark ? 'bg-gray-700' : 'bg-purple-100'} border-b-2">
                                        <th class="px-4 py-3 text-left font-semibold">‡∏£‡∏´‡∏±‡∏™</th>
                                        <th class="px-4 py-3 text-left font-semibold">‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•</th>
                                        ${app.medicationTimes.map(time => `<th class="px-4 py-3 text-center font-semibold text-sm">${time}</th>`).join('')}
                                    </tr>
                                </thead>
                                <tbody class="${isDark ? 'divide-gray-700' : 'divide-gray-200'} divide-y">
                                    ${filtered.map(s => `
                                        <tr class="${isDark ? 'hover:bg-gray-700' : 'hover:bg-gray-50'}">
                                            <td class="px-4 py-3">${s.code}</td>
                                            <td class="px-4 py-3 font-medium">${s.name}</td>
                                            ${app.medicationTimes.map(time => {
                                                const taken = app.medications[s.id]?.[time]?.taken || false;
                                                return `
                                                    <td class="px-4 py-3 text-center">
                                                        <button onclick="updateMedication(${s.id}, '${time}', ${!taken}); render();" class="${taken ? 'bg-purple-500 text-white' : isDark ? 'bg-gray-700 hover:bg-gray-600' : 'bg-gray-200 hover:bg-gray-300'} w-8 h-8 rounded-lg transition-colors">
                                                            ${taken ? '‚úì' : ''}
                                                        </button>
                                                    </td>
                                                `;
                                            }).join('')}
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
        };

        const renderHealthCheckPage = () => {
            const isDark = app.darkMode;
            const filtered = getFilteredStudents();
            return `
                <div class="space-y-6">
                    <h2 class="${isDark ? 'text-white' : 'text-gray-800'} text-lg font-bold">üå°Ô∏è ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û</h2>
                    <div class="${isDark ? 'bg-gray-800' : 'bg-white'} rounded-xl shadow-md p-6">
                        <input type="date" value="${app.selectedDate}" onchange="app.selectedDate = this.value; render();" class="${isDark ? 'bg-gray-700 text-white border-gray-600' : 'border-gray-300'} w-full mb-4 px-4 py-2 border rounded-lg" />
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm">
                                <thead>
                                    <tr class="${isDark ? 'bg-gray-700' : 'bg-red-100'} border-b-2">
                                        <th class="px-4 py-3 text-left font-semibold">‡∏£‡∏´‡∏±‡∏™</th>
                                        <th class="px-4 py-3 text-left font-semibold">‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•</th>
                                        <th class="px-4 py-3 text-left font-semibold">‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥ (¬∞C)</th>
                                        <th class="px-4 py-3 text-left font-semibold">‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å (kg)</th>
                                        <th class="px-4 py-3 text-left font-semibold">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th>
                                    </tr>
                                </thead>
                                <tbody class="${isDark ? 'divide-gray-700' : 'divide-gray-200'} divide-y">
                                    ${filtered.map(s => {
                                        const health = app.healthData[s.id] || {};
                                        const tempError = health.temperature && (parseFloat(health.temperature) < 35 || parseFloat(health.temperature) > 42);
                                        const weightError = health.weight && (parseFloat(health.weight) < 20 || parseFloat(health.weight) > 200);
                                        return `
                                            <tr class="${isDark ? 'hover:bg-gray-700' : 'hover:bg-gray-50'}">
                                                <td class="px-4 py-3">${s.code}</td>
                                                <td class="px-4 py-3 font-medium">${s.name}</td>
                                                <td class="px-4 py-3">
                                                    <input type="number" step="0.1" value="${health.temperature || ''}" onchange="updateHealth(${s.id}, 'temperature', this.value); render();" class="${isDark ? 'bg-gray-700 text-white border-gray-600' : ''} ${tempError ? 'border-red-500' : 'border-gray-300'} w-24 px-3 py-2 border rounded-lg" placeholder="36.5" />
                                                    ${tempError ? '<span class="text-red-500 text-xs">35-42¬∞C</span>' : ''}
                                                </td>
                                                <td class="px-4 py-3">
                                                    <input type="number" step="0.1" value="${health.weight || ''}" onchange="updateHealth(${s.id}, 'weight', this.value); render();" class="${isDark ? 'bg-gray-700 text-white border-gray-600' : ''} ${weightError ? 'border-red-500' : 'border-gray-300'} w-24 px-3 py-2 border rounded-lg" placeholder="50" />
                                                    ${weightError ? '<span class="text-red-500 text-xs">20-200 kg</span>' : ''}
                                                </td>
                                                <td class="px-4 py-3">
                                                    <input type="text" value="${health.notes || ''}" onchange="updateHealth(${s.id}, 'notes', this.value); render();" class="${isDark ? 'bg-gray-700 text-white border-gray-600' : 'border-gray-300'} w-full px-3 py-2 border rounded-lg" placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏" />
                                                </td>
                                            </tr>
                                        `;
                                    }).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
        };

        const renderStatisticsPage = () => {
            const isDark = app.darkMode;
            const stats = getMonthlyStats();
            return `
                <div class="space-y-6">
                    <h2 class="${isDark ? 'text-white' : 'text-gray-800'} text-lg font-bold">üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="bg-gradient-to-br from-green-500 to-green-600 rounded-xl p-6 text-white shadow-lg">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-green-100 text-sm">‡πÄ‡∏Ç‡πâ‡∏≤‡∏ô‡∏≠‡∏ô</p>
                                    <p class="text-4xl font-bold mt-2">${stats.presentCount}</p>
                                </div>
                                <div class="text-5xl">‚úì</div>
                            </div>
                        </div>
                        <div class="bg-gradient-to-br from-yellow-500 to-yellow-600 rounded-xl p-6 text-white shadow-lg">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-yellow-100 text-sm">‡∏™‡πà‡∏á/‡∏ñ‡∏≠‡∏ô‡∏ä‡∏∑‡πà‡∏≠</p>
                                    <p class="text-4xl font-bold mt-2">${stats.sentCount}</p>
                                </div>
                                <div class="text-5xl">‚è±Ô∏è</div>
                            </div>
                        </div>
                        <div class="bg-gradient-to-br from-red-500 to-red-600 rounded-xl p-6 text-white shadow-lg">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-red-100 text-sm">‡∏Ç‡∏≤‡∏î‡∏ô‡∏≠‡∏ô</p>
                                    <p class="text-4xl font-bold mt-2">${stats.absentCount}</p>
                                </div>
                                <div class="text-5xl">‚úï</div>
                            </div>
                        </div>
                    </div>
                    <div class="${isDark ? 'bg-gray-800' : 'bg-white'} rounded-xl shadow-md p-6">
                        <h3 class="${isDark ? 'text-white' : 'text-gray-800'} font-bold mb-4">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</h3>
                        <div class="space-y-2 text-sm">
                            <p><strong>‡∏£‡∏ß‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô:</strong> ${app.students.length}</p>
                            <p><strong>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ä‡πâ‡∏≤:</strong> ${Object.keys(app.attendance).filter(id => app.attendance[id]?.morning).length}</p>
                            <p><strong>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏¢‡πá‡∏ô:</strong> ${Object.keys(app.attendance).filter(id => app.attendance[id]?.evening).length}</p>
                        </div>
                    </div>
                </div>
            `;
        };

        const renderSettingsPage = () => {
            const isDark = app.darkMode;
            return `
                <div class="space-y-6">
                    <h2 class="${isDark ? 'text-white' : 'text-gray-800'} text-lg font-bold">‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö</h2>

                    <div class="${isDark ? 'bg-gray-800' : 'bg-white'} rounded-xl shadow-md p-6">
                        <h3 class="${isDark ? 'text-white' : 'text-gray-800'} font-bold mb-4">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="${isDark ? 'text-gray-300' : 'text-gray-700'} block text-sm font-medium mb-2">‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label>
                                <input type="text" value="${app.systemSettings.schoolName}" onchange="app.systemSettings.schoolName = this.value; saveData(); render();" class="${isDark ? 'bg-gray-700 text-white border-gray-600' : 'border-gray-300'} w-full px-4 py-2 border rounded-lg" />
                            </div>
                            <div>
                                <label class="${isDark ? 'text-gray-300' : 'text-gray-700'} block text-sm font-medium mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏∞‡∏ö‡∏ö</label>
                                <input type="text" value="${app.systemSettings.dormName}" onchange="app.systemSettings.dormName = this.value; saveData(); render();" class="${isDark ? 'bg-gray-700 text-white border-gray-600' : 'border-gray-300'} w-full px-4 py-2 border rounded-lg" />
                            </div>
                        </div>
                    </div>

                    ${app.currentUser?.role === 'admin' ? `
                        <div class="${isDark ? 'bg-gray-800' : 'bg-white'} rounded-xl shadow-md p-6">
                            <h3 class="${isDark ? 'text-white' : 'text-gray-800'} font-bold mb-4">üë• ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</h3>
                            <div class="space-y-3 mb-4">
                                ${app.users.map(user => `
                                    <div class="${isDark ? 'bg-gray-700' : 'bg-gray-50'} flex items-center justify-between p-3 rounded-lg">
                                        <div>
                                            <p class="${isDark ? 'text-white' : 'text-gray-800'} font-medium">${user.name}</p>
                                            <p class="${isDark ? 'text-gray-400' : 'text-gray-500'} text-xs">${user.username} ‚Ä¢ ${user.role === 'admin' ? 'üë®‚Äçüíº Admin' : 'üë®‚Äçüè´ Teacher'}</p>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                            <button onclick="app.showModals.addUser = true; render();" class="w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</button>
                        </div>
                    ` : ''}

                    <div class="${isDark ? 'bg-gray-800' : 'bg-white'} rounded-xl shadow-md p-6">
                        <h3 class="${isDark ? 'text-white' : 'text-gray-800'} font-bold mb-4">üîê ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</h3>
                        <button onclick="app.showModals.changePassword = true; render();" class="px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 font-medium">‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</button>
                    </div>

                    <div class="${isDark ? 'bg-gray-700' : 'bg-gradient-to-r from-blue-50 to-blue-100'} rounded-xl shadow-md p-6">
                        <h3 class="${isDark ? 'text-white' : 'text-gray-800'} font-bold mb-4">üìã ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</h3>
                        <div class="space-y-2 text-sm">
                            <p><strong>‡∏ä‡∏∑‡πà‡∏≠:</strong> ${app.currentUser?.name}</p>
                            <p><strong>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ:</strong> ${app.currentUser?.username}</p>
                            <p><strong>‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó:</strong> ${app.currentUser?.role === 'admin' ? 'üë®‚Äçüíº ‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏ö‡∏ö' : 'üë®‚Äçüè´ ‡∏Ñ‡∏£‡∏π‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏´‡∏≠'}</p>
                        </div>
                    </div>
                </div>
            `;
        };

        // Initial render
        if (app.darkMode) document.documentElement.classList.add('dark');
        render();

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && app.sidebarOpen) {
                app.sidebarOpen = false;
                render();
            }
        });
    </script>
</body>
</html>
